<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" href="../materialize/css/materialize.css">
        <link rel="stylesheet" type="text/css" href="../style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <style>
            .delete {
                background-color: lightblue;
                color: white;
                padding: 2px;
            }
        </style>
    </head>
    <body>
        <div id="everything">
<!--             <span class="delete" id="123"> ok</span>-->
            <div id="navigation">
                <button type="submit" class= "btn btn-default" onclick ="window.location='/'">Home</button>
                <button type="submit" class= "btn btn-default">Profile</button>
                <button type="submit" class="btn btn-default" onclick="window.location='/search'">Search</button>
                <button type="submit" class="btn btn-default" onclick ="window.location='/logout'">Logout</button>    
            </div>

            <div id="userInfo">
                <h2>Twitter</h2>
                <img src="../img/cat.jpg" width="200px"> <br>
                <div id="info"> </div>
            </div>

            <div id="tweetsInfo">
                <div id="newsfeed"></div>
            </div>
            
        </div>
        <script>
            
            $(document).ready(function () {
                var arr = (window.location.pathname).split("/");
                var username = arr[arr.length-1];
            
                $(".delete").click(function () {
                    alert("ya called?");
                    alert(this.id);
                });
                
                var user = "";
                $.ajax({
                    url: "/whoami", 
                    type: "POST"
                }).done(function(data) {
                    if (data.status == "OK") {
                        user = data.username;
                        $.ajax({
                            "url": "/search",
                            "type":"POST",
                            "data": JSON.stringify({
                                username: username,
                            }), 
                            "dataType": "json", 
                            "contentType": "application/json; charset=utf-8"
                        }).done(function(data) {
                            if (data.status == "OK"){
                                
                                var button ="";
                                for (var i = 0; i < data.items.length; i++) {
                                    if (username == user)
                                        button = "<span class='delete'> delete </span>";
                                    $("#newsfeed").prepend ("<div class='tweet'> Id #" + data.items[i].id + " @" + data.items[i].username + " Timestamp [" + data.items[i].timestamp + "]<br>" + data.items[i].content + "<br>" +button + "</div>");
                                }
                            } else {
                                window.location = "/login";
                            }
                        });
                    }
                });
                

                $.ajax ({
                    url: "/user/" + username,
                    type: "GET",
                    "dataType": "json", 
                    "contentType": "application/json; charset=utf-8", 
                    success: function (data) {
                        if (data.status == "OK") {
                            
                            var followers = "<a href='/followers/" + username + "'> Followers </a>";
                            var following = "<a href='/following/" + username + "'> Following </a>";
                            
                            $("#info").append("@" + username + "<br>" + "Email: " +data.user.email + "<br>"  + data.user.followers + " " + followers + "<br>" + data.user.following + " " + following); 
                        } else {
                            $("#everything").html("This profile does not exist or you are not logged in");
                        }
                    }
                });
                
                
                

            });
    
        </script>
    </body>
</html>

