<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" href="../materialize/css/materialize.css">
        <link rel="stylesheet" type="text/css" href="../style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
        <style>
            .delete {
                color: #79A7BA;
                padding: 2px;
            }
        </style>
    </head>
    <body>
        <!-- ANGULAR -->
        <div id="everything" ng-app="myApp" ng-controller="myCtrl">
            
            <div id="navigation">
                <button type="submit" class= "btn btn-default" onclick ="window.location='/'">Home</button>
                <button type="submit" class= "btn btn-default" id = "profileClick">Profile</button>
                <button type="submit" class="btn btn-default" onclick="window.location='/search'">Search</button>
                <button type="submit" class="btn btn-default" onclick ="window.location='/logout'">Logout</button>    
            </div>

            <div id="userInfo">
                <h2>Twitter</h2>
                <img src="../img/cat.jpg" width="200px"> <br>
                <div id="info">
                    @ {{whoami.username}} <br>
                    Email: {{userinfo.user.email}} <br>
                    {{userinfo.user.followers}} <a href="/followers/{{whoami.username}}">Followers</a> <br>
                    {{userinfo.user.following}} <a href="/following/{{whoami.username}}">Following </a>
                </div>
            </div>

            <div id="tweetsInfo">
               
                <div class="tweet" ng-repeat = "tweet in newsfeed.items">
                    Id #{{tweet.id}} @{{tweet.username}}
                    Timestamp: {{tweet.timestamp}}
                    <br>
                    {{tweet.content}} 
                    
                    <br>
                    <a href="" class="delete" id= "{{tweet.id}}" ng-click=deleteTweet(tweet.id)>{{deleteButton}}</a>
                    
                </div>

             
            </div>
                
            
        </div>
         <!-- ANGULAR -->
        
        <script>
            

            var app = angular.module('myApp', []);
            app.controller('myCtrl', function($scope, $http) {
                $scope.deleteTweet = function (id) {
                   
                    var delTweet = $http.delete("/item/" + id);
                    delTweet.success(function(data, status) {
                        location.reload();
                    });
                }
                
                var arr = (window.location.pathname).split("/");
                var username = arr[arr.length-1];
                $scope.profileUser = username;
                
                var whoami = $http.post("/whoami");
                whoami.success(function (data, status) {
                    if (data.status == "OK") {
                        $scope.whoami = data;
                        var newlocation = "window.location='/profile/" + $scope.whoami.username + "'";
                        document.getElementById('profileClick').setAttribute('onclick',newlocation);
                    } else 
                        window.location = "/login";
                });
                
                var userinfo = $http.get("/user/" + username);
                userinfo.success(function (data) {
                    if (data.status == "OK")
                        $scope.userinfo = data;
                    else 
                        $("#everything").html("This profile does not exist.");
                });
                
                var newsfeed = $http.post("/search", JSON.stringify({username:username}));
                newsfeed.success(function (data) {
                    if (data.status == "OK") {
                        $scope.newsfeed = data;
                        $scope.deleteButton = "";
                        if ($scope.profileUser == $scope.whoami.username)
                            $scope.deleteButton = "delete";
                    } else
                        window.location = "/login";
                });
            
            });

    
        </script>
    </body>
</html>

